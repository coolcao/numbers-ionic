<div class="relative-container">
  <!-- Pixi Canvas 容器 -->
  <div
    #pixiContainer
    class="block h-full w-full"
    [style.visibility]="introVisible ? 'hidden' : 'visible'"
    [style.opacity]="introVisible ? '0' : '1'"
    [style.pointer-events]="introVisible ? 'none' : 'auto'"
  ></div>

  <div class="intro-overlay" *ngIf="introVisible">
    <div
      class="intro-page flex flex-col items-center justify-center px-6 py-10"
    >
      <div class="text-6xl">🧸</div>
      <h2 class="mt-3 text-5xl font-black text-cyan-800 dark:text-teal-500">
        快乐售卖机
      </h2>
      <p
        class="mt-4 whitespace-pre-line text-center text-xl font-bold text-teal-700 dark:text-teal-400"
      >
        选一个玩具，投币凑够金额
      </p>
      <p
        class="mt-4 whitespace-pre-line text-center text-xl font-bold text-teal-700 dark:text-teal-400"
      >
        买到喜欢的礼物吧！
      </p>
      <div
        class="mt-6 flex flex-wrap justify-center gap-4 text-base font-bold text-teal-700"
      >
        <div class="rounded-full bg-white/80 px-2 py-2 shadow-md md:px-4">
          🧸 选玩具
        </div>
        <div class="rounded-full bg-white/80 px-2 py-2 shadow-md md:px-4">
          🪙 投硬币
        </div>
        <div class="rounded-full bg-white/80 px-2 py-2 shadow-md md:px-4">
          🎁 收礼物
        </div>
      </div>
      <button
        class="mt-10 inline-flex items-center justify-center rounded-full bg-gradient-to-r from-teal-400 to-cyan-500 px-12 py-4 text-2xl font-bold text-white shadow-xl transition-transform hover:scale-105 active:scale-95"
        (click)="startGame()"
      >
        <span class="mr-2">🌟</span>
        开始游戏
      </button>
    </div>
  </div>

  <div class="tutorial-overlay" *ngIf="tutorialService.isPlaying()">
    <div
      class="tutorial-dimmer"
      [ngStyle]="{
        'mask-image': tutorialService.spotlight()
          ? 'radial-gradient(circle ' +
            tutorialService.spotlight()?.r +
            'px at ' +
            tutorialService.spotlight()?.x +
            'px ' +
            tutorialService.spotlight()?.y +
            'px, transparent 0%, black 100%)'
          : 'none',
        '-webkit-mask-image': tutorialService.spotlight()
          ? 'radial-gradient(circle ' +
            tutorialService.spotlight()?.r +
            'px at ' +
            tutorialService.spotlight()?.x +
            'px ' +
            tutorialService.spotlight()?.y +
            'px, transparent 0%, black 100%)'
          : 'none',
      }"
    ></div>

    <div
      class="tutorial-instruction"
      [class.tutorial-instruction-bottom]="
        tutorialService.instructionPosition() === 'bottom'
      "
      *ngIf="tutorialService.instruction() as text"
    >
      <p class="tutorial-instruction-text">{{ text }}</p>
      <button class="tutorial-skip" (click)="tutorialService.skip()">
        跳过
      </button>
    </div>

    <div
      class="tutorial-ring"
      *ngIf="tutorialService.spotlight() as spot"
      [style.left.px]="spot.x - spot.r"
      [style.top.px]="spot.y - spot.r"
      [style.width.px]="spot.r * 2"
      [style.height.px]="spot.r * 2"
    ></div>

    <div
      class="tutorial-hand"
      *ngIf="tutorialService.handPosition() as hand"
      [style.left.px]="hand.x"
      [style.top.px]="hand.y"
    >
      <i
        class="fa-solid fa-hand-pointer"
        [class.hand-click]="tutorialService.handAction() === 'click'"
        [class.hand-drag]="tutorialService.handAction() === 'drag'"
      ></i>
    </div>
  </div>
</div>
